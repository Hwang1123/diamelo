<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kh.diamelo.mappers.ProductMapper">

    <resultMap id="ProductResultMap" type="com.kh.diamelo.domain.vo.Product">
        <result column="pro_no" property="proNo"/>
        <result column="procategory_no" property="proCategoryNo"/>
        <result column="pro_name" property="proName"/>
        <result column="pro_detail" property="proDetail"/>
        <result column="pro_price" property="proPrice"/>
        <result column="pro_deleted" property="proDeleted"/>
        <result column="is_product" property="isProduct"/>
    </resultMap>
    <!-- 제품 목록 조회 -->
    <select id="getProductList" resultMap="ProductResultMap">
        SELECT pro_no, procategory_no, pro_name, pro_detail, pro_price, pro_deleted, is_product
        FROM product
        WHERE pro_deleted = 'N' AND IS_PRODUCT ='Y'
    </select>

    <!-- 제품 이미지 조회 -->
    <select id="getProductImage" resultType="string">
        SELECT FILE_PATH FROM ATTACHMENT WHERE PRO_NO = #{productNo}
    </select>

    <!-- 특정 제품의 재료 목록 조회 -->
    <select id="getMaterialsByProductNo" resultType="Product">
        SELECT
        m.PRO_NO AS matNo,
        m.PRO_NAME AS materialName,
        r.AMOUNT AS amount
        FROM RECIPE r
        JOIN PRODUCT m ON r.MAT_NO = m.PRO_NO
        WHERE r.PRO_NO = #{productNo}
    </select>
</mapper>